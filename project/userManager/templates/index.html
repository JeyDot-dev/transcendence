{% load static %}
<div>
	<h2>Log in to play</h2>
	<button type="button" class="btn btn-primary m-4" data-bs-toggle="modal" data-bs-target="#loginModal">
		Login
	</button>
	<br />
	<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#signupModal">
		Create account
	</button>
	<button type="button" onclick="logout()">
		Logout
	</button>
</div>

{% if user.is_authenticated %}
	<p>User connected</p>
	<img src="{% static user.profile_pic.url %}" alt="Profile Picture" style="width: 100px; height: 100px;" id="pp">
	<p>Username: {{ user.username }}</p>
	<p>Email: {{ user.email }}</p>
	<p>Status: {{ user.status }}</p>
	<p>Total games: {{ user.total_games }}</p>
	<p>Wins: {{ user.total_victories }}</p>
	<p>skin: {{ user.skin }}</p>
	<p>Grade: {{ user.grade }}</p>
	<p>Is online: {{ user.is_online }}</p>
	<p>Is playing: {{ user.is_playing }}</p>

	<form id="profilePictureForm" enctype="multipart/form-data">
		{% csrf_token %}
		<input type="hidden" name="username" value={{ user.username }}>
		<input type="file" name="profile_pic" accept="image/*" required>
		<button type="submit">Upload Profile Picture</button>
	</form>
	<script>
		console.log('{{ user.profile_pic.url }}')

		{% comment %} document.getElementById('pp').src = '{{ user.profile_pic.url }}'; {% endcomment %}
		document.getElementById('profilePictureForm').addEventListener('submit', function(e) {
			e.preventDefault();
			console.log('submitting');
			var form = document.getElementById('profilePictureForm');
			var formData = new FormData(form);

			uploadProfilePicture(formData);
		});
	</script>

	<div>
		<h2>Change email</h2>
		<textarea id="email" placeholder="Email" required>{{ user.email }}</textarea>
		<button onclick="changeUserValue('email', document.getElementById('email').value, '{{ user.username }}')">Change email</button>
	</div>

	<div>
		<h2>Change password</h2>
		<form id="changePasswordForm">
			{% csrf_token %}
			<input type="hidden" name="username" value={{ user.username }}>
			<input type="password" name="old_password" placeholder="Old password" required>
			<input type="password" name="new_password" placeholder="New password" required>
			<input type="password" name="new_password_confirm" placeholder="Confirm new password" required>
			<button type="submit">Change password</button>
		</form>
		<script>
			document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
				e.preventDefault();
				var form = document.getElementById('changePasswordForm');
				var formData = new FormData(form);

				changeUserValue("new_password", formData.get("new_password").toString());
			});
		</script>

{% else %}
	<p>User not connected</p>
{% endif %}

{% include "accountCreation.html" %}
{% include "accountLogin.html" %}
